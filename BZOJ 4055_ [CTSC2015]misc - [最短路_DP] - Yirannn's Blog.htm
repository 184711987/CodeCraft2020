<!DOCTYPE html>
<!-- saved from url=(0033)https://yirannn.com/dp/bzoj_4055/ -->
<html class="no-js"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <title>BZOJ 4055: [CTSC2015]misc - [最短路/DP] - Yirannn's Blog</title>  <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta http-equiv="Cache-Control" content="no-transform"> <meta http-equiv="Cache-Control" content="no-siteapp"> <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"> <meta name="description" content="题目传送门(BZOJ) &gt;原文链接&lt; 题解 ： 这可能是网上存在的第一篇题解，反正我Baidu只百度到一个，还是404 推导： 设$F[i][j]$为从$i$到$j$的最短路的宽度，那么原式即求 ： $$R(k) = \sum\limits_{i\neq j\neq k}\frac{a_i\times a_j\times F[i][k]\times F[k][j]}{F[i][j]}$$ 把这个式子分开: $"> <meta name="keywords" content="BZOJ 4055: [CTSC2015]misc - [最短路/DP] - Yirannn&#39;s Blog,动态规划,最短路,"> <!-- This site is optimized with the Yoast SEO plugin v11.2.1 - https://yoast.com/wordpress/plugins/seo/ --><link rel="canonical" href="https://yirannn.com/dp/bzoj_4055/"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="og:title" content="BZOJ 4055: [CTSC2015]misc - [最短路/DP] - Yirannn&#39;s Blog"><meta property="og:description" content="题目传送门(BZOJ) &gt;原文链接&lt; 题解 ： 这可能是网上存在的第一篇题解，反正我Baidu只百度到一个，还是404 推导： 设F[i][j]为从i到j的最短路的宽度，那么原式即求 ： R(k) = \sum\limits_{i\neq j\neq k}\frac{a_i\times a_j\times F[i][k]\times……"><meta property="og:url" content="https://yirannn.com/dp/bzoj_4055/"><meta property="og:site_name" content="Yirannn&#39;s Blog"><meta property="article:section" content="动态规划"><meta property="article:published_time" content="2018-10-02T01:05:00+00:00"><meta property="article:modified_time" content="2018-10-09T07:02:36+00:00"><meta property="og:updated_time" content="2018-10-09T07:02:36+00:00"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:description" content="题目传送门(BZOJ) &gt;原文链接&lt; 题解 ： 这可能是网上存在的第一篇题解，反正我Baidu只百度到一个，还是404 推导： 设F[i][j]为从i到j的最短路的宽度，那么原式即求 ： R(k) = \sum\limits_{i\neq j\neq k}\frac{a_i\times a_j\times F[i][k]\times……"><meta name="twitter:title" content="BZOJ 4055: [CTSC2015]misc - [最短路/DP] - Yirannn&#39;s Blog"><script type="application/ld+json" class="yoast-schema-graph yoast-schema-graph--main">{"@context":"https://schema.org","@graph":[{"@type":"WebSite","@id":"https://yirannn.com/#website","url":"https://yirannn.com/","name":"Yirannn&#039;s Blog","publisher":{"@id":"https://yirannn.com/#person"},"potentialAction":{"@type":"SearchAction","target":"https://yirannn.com/?s={search_term_string}","query-input":"required name=search_term_string"}},{"@type":"WebPage","@id":"https://yirannn.com/dp/bzoj_4055/#webpage","url":"https://yirannn.com/dp/bzoj_4055/","inLanguage":"zh-CN","name":"BZOJ 4055: [CTSC2015]misc - [\u6700\u77ed\u8def/DP] - Yirannn&#039;s Blog","isPartOf":{"@id":"https://yirannn.com/#website"},"datePublished":"2018-10-02T01:05:00+00:00","dateModified":"2018-10-09T07:02:36+00:00"},{"@type":"Article","@id":"https://yirannn.com/dp/bzoj_4055/#article","isPartOf":{"@id":"https://yirannn.com/dp/bzoj_4055/#webpage"},"author":{"@id":"https://yirannn.com/author/yirannn/#author","name":"Yirannn"},"publisher":{"@id":"https://yirannn.com/#person"},"headline":"BZOJ 4055: [CTSC2015]misc - [\u6700\u77ed\u8def/DP]","datePublished":"2018-10-02T01:05:00+00:00","dateModified":"2018-10-09T07:02:36+00:00","commentCount":0,"mainEntityOfPage":"https://yirannn.com/dp/bzoj_4055/#webpage","articleSection":"\u52a8\u6001\u89c4\u5212,\u6700\u77ed\u8def"},{"@type":"Person","@id":"https://yirannn.com/author/yirannn/#author","name":"Yirannn","image":{"@type":"ImageObject","@id":"https://yirannn.com/#personlogo","url":"https://secure.gravatar.com/avatar/63e7bd2c7a6a36fd3105e8c2f1d58f02?s=96&d=identicon&r=g","caption":"Yirannn"},"sameAs":[]}]}</script><!-- / Yoast SEO plugin. --><link rel="dns-prefetch" href="https://cdn.jsdelivr.net/"><link rel="dns-prefetch" href="https://s.w.org/"><link rel="stylesheet" id="wp-block-library-css" href="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/style.min.css" type="text/css" media="all"><link rel="stylesheet" id="live2d-base-css" href="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/live2d.css" type="text/css" media="all"><link rel="stylesheet" id="Katex-css" href="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/katex.min.css" type="text/css" media="all"><link rel="stylesheet" id="prism-theme-default-css" href="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/prism.css" type="text/css" media="all"><link rel="stylesheet" id="prism-plugin-toolbar-css" href="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/prism-toolbar.css" type="text/css" media="all"><link rel="stylesheet" id="prism-plugin-line-numbers-css" href="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/prism-line-numbers.css" type="text/css" media="all"><link rel="stylesheet" id="bootstrap-style-css" href="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/bootstrap.css" type="text/css" media="all"><link rel="stylesheet" id="fontawesome-style-css" href="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/font-awesome.css" type="text/css" media="all"><link rel="stylesheet" id="animate-style-css" href="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/animate.css" type="text/css" media="all"><link rel="stylesheet" id="bootsnav-style-css" href="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/bootsnav.css" type="text/css" media="all"><link rel="stylesheet" id="snape-style-css" href="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/style.css" type="text/css" media="all"><link rel="https://api.w.org/" href="https://yirannn.com/wp-json/"><link rel="alternate" type="application/json+oembed" href="https://yirannn.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fyirannn.com%2Fdp%2Fbzoj_4055%2F"><link rel="alternate" type="text/xml+oembed" href="https://yirannn.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fyirannn.com%2Fdp%2Fbzoj_4055%2F&amp;format=xml"><script type="text/javascript">var live2d_Path = "https://yirannn.com/wp-content/plugins/Poilive2dv1.0.5E/live2d/model/pio/";var message_Path = "https://yirannn.com/wp-content/plugins/Poilive2dv1.0.5E/live2d/";var home_Path = "https://yirannn.com/";var nohitokoto = true;var nospecialtip = false;</script><style>.message{border-color:rgba(206,0,255,.4);background-color:rgba(206,0,255,.2);box-shadow:0 3px 15px 2px rgba(206,0,255,.4);color:rgba(206,0,255,.6);}.hide-button,.switch-button{border-color:rgba(206,0,255,.4);background:rgba(206,0,255,.2);box-shadow:0 3px 15px 2px rgba(206,0,255,.4);color:rgba(206,0,255,.6);}.hide-button:hover,.switch-button:hover{border-color:rgba(206,0,255,.6);background:rgba(206,0,255,.4);color:rgba(206,0,255,.8);}</style><link rel="icon" href="https://yirannn.com/wp-content/uploads/2018/08/cropped-15-1-32x32.jpg" sizes="32x32"><link rel="icon" href="https://yirannn.com/wp-content/uploads/2018/08/cropped-15-1-192x192.jpg" sizes="192x192"><link rel="apple-touch-icon-precomposed" href="https://yirannn.com/wp-content/uploads/2018/08/cropped-15-1-180x180.jpg"><meta name="msapplication-TileImage" content="https://yirannn.com/wp-content/uploads/2018/08/cropped-15-1-270x270.jpg"> </head><style id="stylish-1" class="stylish" type="text/css">.blob-code-inner {
    font-family: Monaco;
    font-size: 14px;
    line-height: 24px;
}</style> <body style=""><div class="wrapper"> <nav class="navbar navbar-default navbar-fixed bootsnav on no-full"> <div class="top-search"> <div class="container"> <div class="input-group"> <span class="input-group-addon"><i class="fa fa-search"></i></span> <form role="search" method="get" action="https://yirannn.com/"> <input type="text" name="s" id="s" placeholder="Search…" class="form-control" x-webkit-speech=""> </form> <span class="input-group-addon close-search"><i class="fa fa-times"></i></span> </div> </div> </div> <div class="container"> <div class="attr-nav"> <ul> <li class="search"><a href="https://yirannn.com/dp/bzoj_4055/#"><i class="fa fa-search"></i></a></li> </ul> </div> <div class="navbar-header"> <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-menu"> <i class="fa fa-bars"></i> </button> <a class="navbar-brand title-noimg" href="https://yirannn.com/">Yirannn's Blog</a> </div> <div id="navbar-menu" class="collapse navbar-collapse"><ul id="menu-%e5%b7%a6%e4%be%a7%e8%8f%9c%e5%8d%95" class="nav navbar-nav navbar-right"><li><a title="首页" href="https://yirannn.com/">首页</a></li><li><a title="友链" href="https://yirannn.com/friends/">友链</a></li><li><a title="归档" href="https://yirannn.com/sitemap/">归档</a></li></ul></div> </div> </nav> <div class="clearfix"></div><div class="pageheader headtbanner" style="background-image: url(https://yirannn.com/wp-content/themes/Snape-master/images/dark-wall.png);background-position: center"> <div class="container text-center"> <h2 class="title">BZOJ 4055: [CTSC2015]misc - [最短路/DP]</h2> <div class="text-center"> <span> <i class="fa fa-calendar"></i> 2018/10/2 <i class="fa fa-commenting-o"></i> 0 Comments <i class="fa fa-eye"></i> 576 Views <i class="fa fa-thumbs-o-up"></i> 3 Times </span> </div> </div></div><div class="post-section post-main" style="background-image: url(https://yirannn.com/wp-content/uploads/2018/08/13.jpg);"> <div class="container"> <div class="row"> <div class="col-md-8"> <article> <div class="post-inner post-border clearfix"> <div class="post-content"> <p><span id="more-564"></span><br><a href="https://lydsy.com/JudgeOnline/problem.php?id=4055" target="_blank" rel="nofollow">题目传送门</a>(BZOJ)<br><a href="https://yirannn.com/dp/bzoj_4055/">&gt;原文链接&lt;</a></p><h3>题解 ：</h3><blockquote><p> 这可能是网上存在的第一篇题解，反正我Baidu只百度到一个，还是404</p></blockquote><h4>推导：</h4><p>设<span class="katex math inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>F</mi><mo>[</mo><mi>i</mi><mo>]</mo><mo>[</mo><mi>j</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">F[i][j]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">F</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathit" style="margin-right: 0.05724em;">j</span><span class="mclose">]</span></span></span></span></span>为从<span class="katex math inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.65952em; vertical-align: 0em;"></span><span class="mord mathit">i</span></span></span></span></span>到<span class="katex math inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.85396em; vertical-align: -0.19444em;"></span><span class="mord mathit" style="margin-right: 0.05724em;">j</span></span></span></span></span>的最短路的宽度，那么原式即求 ：</p><p><span class="katex math multi-line"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>R</mi><mo>(</mo><mi>k</mi><mo>)</mo><mo>=</mo><munder><mo>∑</mo><mrow><mi>i</mi><mi mathvariant="normal">≠</mi><mi>j</mi><mi mathvariant="normal">≠</mi><mi>k</mi></mrow></munder><mfrac><mrow><msub><mi>a</mi><mi>i</mi></msub><mo>×</mo><msub><mi>a</mi><mi>j</mi></msub><mo>×</mo><mi>F</mi><mo>[</mo><mi>i</mi><mo>]</mo><mo>[</mo><mi>k</mi><mo>]</mo><mo>×</mo><mi>F</mi><mo>[</mo><mi>k</mi><mo>]</mo><mo>[</mo><mi>j</mi><mo>]</mo></mrow><mrow><mi>F</mi><mo>[</mo><mi>i</mi><mo>]</mo><mo>[</mo><mi>j</mi><mo>]</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">R(k) = \sum\limits_{i\neq j\neq k}\frac{a_i\times a_j\times F[i][k]\times F[k][j]}{F[i][j]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit" style="margin-right: 0.00773em;">R</span><span class="mopen">(</span><span class="mord mathit" style="margin-right: 0.03148em;">k</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.86522em; vertical-align: -1.43822em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05001em;"><span class="" style="top: -1.84789em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mrel mtight"><span class="mrel mtight"><span class="mord mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.69444em;"><span class="" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="rlap mtight"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="inner"><span class="mrel latin_fallback mtight"≯</span></span><span class="fix"></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span></span><span class="mrel mtight">=</span></span><span class="mord mathit mtight" style="margin-right: 0.05724em;">j</span><span class="mrel mtight"><span class="mrel mtight"><span class="mord mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.69444em;"><span class="" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="rlap mtight"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="inner"><span class="mrel latin_fallback mtight"≯</span></span><span class="fix"></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span></span><span class="mrel mtight">=</span></span><span class="mord mathit mtight" style="margin-right: 0.03148em;">k</span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.43822em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.427em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.13889em;">F</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathit" style="margin-right: 0.05724em;">j</span><span class="mclose">]</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathit">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathit">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right: 0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">F</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathit" style="margin-right: 0.03148em;">k</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">F</span><span class="mopen">[</span><span class="mord mathit" style="margin-right: 0.03148em;">k</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathit" style="margin-right: 0.05724em;">j</span><span class="mclose">]</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.936em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span></p><p>把这个式子分开:</p><p><span class="katex math multi-line"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>R</mi><mo>(</mo><mi>k</mi><mo>)</mo><mo>=</mo><munder><mo>∑</mo><mrow><mi>i</mi><mi mathvariant="normal">≠</mi><mi>j</mi><mi mathvariant="normal">≠</mi><mi>k</mi></mrow></munder><msub><mi>a</mi><mi>i</mi></msub><mo>×</mo><mi>F</mi><mo>[</mo><mi>i</mi><mo>]</mo><mo>[</mo><mi>k</mi><mo>]</mo><mo>×</mo><mfrac><mrow><msub><mi>a</mi><mi>j</mi></msub><mo>×</mo><mi>F</mi><mo>[</mo><mi>k</mi><mo>]</mo><mo>[</mo><mi>j</mi><mo>]</mo></mrow><mrow><mi>F</mi><mo>[</mo><mi>i</mi><mo>]</mo><mo>[</mo><mi>j</mi><mo>]</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">R(k) = \sum\limits_{i\neq j\neq k}a_i\times F[i][k]\times\frac{a_j\times F[k][j]}{F[i][j]}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit" style="margin-right: 0.00773em;">R</span><span class="mopen">(</span><span class="mord mathit" style="margin-right: 0.03148em;">k</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.48823em; vertical-align: -1.43822em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05001em;"><span class="" style="top: -1.84789em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mrel mtight"><span class="mrel mtight"><span class="mord mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.69444em;"><span class="" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="rlap mtight"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="inner"><span class="mrel latin_fallback mtight"≯</span></span><span class="fix"></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span></span><span class="mrel mtight">=</span></span><span class="mord mathit mtight" style="margin-right: 0.05724em;">j</span><span class="mrel mtight"><span class="mrel mtight"><span class="mord mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.69444em;"><span class="" style="top: -2.7em;"><span class="pstrut" style="height: 2.7em;"></span><span class="rlap mtight"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="inner"><span class="mrel latin_fallback mtight"≯</span></span><span class="fix"></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.19444em;"><span class=""></span></span></span></span></span></span><span class="mrel mtight">=</span></span><span class="mord mathit mtight" style="margin-right: 0.03148em;">k</span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.43822em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathit">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">F</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathit" style="margin-right: 0.03148em;">k</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 2.363em; vertical-align: -0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.427em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.13889em;">F</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathit" style="margin-right: 0.05724em;">j</span><span class="mclose">]</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathit">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right: 0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">F</span><span class="mopen">[</span><span class="mord mathit" style="margin-right: 0.03148em;">k</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathit" style="margin-right: 0.05724em;">j</span><span class="mclose">]</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.936em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span></p><p>对于<span class="katex math inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub><mo>×</mo><mi>F</mi><mo>[</mo><mi>i</mi><mo>]</mo><mo>[</mo><mi>k</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">a_i\times F[i][k]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.73333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathit">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">F</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathit" style="margin-right: 0.03148em;">k</span><span class="mclose">]</span></span></span></span></span>这个可以<span class="katex math inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mn>1</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit" style="margin-right: 0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span>求。</p><h4>DP ：</h4><p>对于后面的，我们则要转换枚举。</p><p>考虑枚举<span class="katex math inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.65952em; vertical-align: 0em;"></span><span class="mord mathit">i</span></span></span></span></span>, 设后面那部分为<span class="katex math inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>g</mi><mo>(</mo><mi>k</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">g(k)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit" style="margin-right: 0.03588em;">g</span><span class="mopen">(</span><span class="mord mathit" style="margin-right: 0.03148em;">k</span><span class="mclose">)</span></span></span></span></span></p><p>我们首先枚举出一个<span class="katex math inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.65952em; vertical-align: 0em;"></span><span class="mord mathit">i</span></span></span></span></span>,并算出以它为源点的<span class="katex math inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>d</mi><mi>i</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">dis</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathit">d</span><span class="mord mathit">i</span><span class="mord mathit">s</span></span></span></span></span>，并以此更新<span class="katex math inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">F</span></span></span></span></span>。</p><p>顺便求出拓扑序(最短路图的拓扑序，只要在最短路中的边)。</p><p>那么对于每个<span class="katex math inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathit">u</span></span></span></span></span>, <span class="katex math inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>a</mi><mi>n</mi><mi>s</mi><mo>[</mo><mi>u</mi><mo>]</mo><mo>+</mo><mo>=</mo><msub><mi>a</mi><mi>i</mi></msub><mo>×</mo><mi>F</mi><mo>[</mo><mi>i</mi><mo>]</mo><mo>[</mo><mi>u</mi><mo>]</mo><mo>×</mo><mi>g</mi><mo>[</mo><mi>u</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">ans[u] += a_i\times F[i][u]\times g[u]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit">a</span><span class="mord mathit">n</span><span class="mord mathit">s</span><span class="mopen">[</span><span class="mord mathit">u</span><span class="mclose">]</span><span class="mord">+</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.73333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathit">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">F</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathit">u</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit" style="margin-right: 0.03588em;">g</span><span class="mopen">[</span><span class="mord mathit">u</span><span class="mclose">]</span></span></span></span></span></p><p>这个<span class="katex math inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>g</mi><mo>[</mo><mi>u</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">g[u]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit" style="margin-right: 0.03588em;">g</span><span class="mopen">[</span><span class="mord mathit">u</span><span class="mclose">]</span></span></span></span></span>可以通过所有<span class="katex math inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathit">u</span></span></span></span></span>可以到达的点的<span class="katex math inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>g</mi></mrow><annotation encoding="application/x-tex">g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord mathit" style="margin-right: 0.03588em;">g</span></span></span></span></span>得到，</p><p>具体做法相当于把<span class="katex math inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>F</mi><mo>[</mo><mi>k</mi><mo>]</mo><mo>[</mo><mi>j</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">F[k][j]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">F</span><span class="mopen">[</span><span class="mord mathit" style="margin-right: 0.03148em;">k</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathit" style="margin-right: 0.05724em;">j</span><span class="mclose">]</span></span></span></span></span>拆开成<span class="katex math inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>F</mi><mo>[</mo><mi>k</mi><mo>]</mo><mo>[</mo><mi>t</mi><mi>o</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">F[k][to]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">F</span><span class="mopen">[</span><span class="mord mathit" style="margin-right: 0.03148em;">k</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathit">t</span><span class="mord mathit">o</span><span class="mclose">]</span></span></span></span></span>和<span class="katex math inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>F</mi><mo>[</mo><mi>t</mi><mi>o</mi><mo>]</mo><mo>[</mo><mi>j</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">F[to][j]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">F</span><span class="mopen">[</span><span class="mord mathit">t</span><span class="mord mathit">o</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathit" style="margin-right: 0.05724em;">j</span><span class="mclose">]</span></span></span></span></span>。</p><p>更新完答案之后别忘了为了下一步的更新<span class="katex math inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>g</mi><mo>[</mo><mi>u</mi><mo>]</mo><mo>+</mo><mo>=</mo><msub><mi>a</mi><mi>u</mi></msub><mo>÷</mo><mi>F</mi><mo>[</mo><mi>i</mi><mo>]</mo><mo>[</mo><mi>u</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">g[u] += a_u\div F[i][u]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit" style="margin-right: 0.03588em;">g</span><span class="mopen">[</span><span class="mord mathit">u</span><span class="mclose">]</span><span class="mord">+</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.73333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathit">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">÷</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">F</span><span class="mopen">[</span><span class="mord mathit">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathit">u</span><span class="mclose">]</span></span></span></span></span></p><h4>提示 ：</h4><p>DP要在逆拓扑序上做，本题又卡精度又卡常，以下是几项提示 ：</p><p><span class="katex math inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>a</mi><mi>n</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">ans</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathit">a</span><span class="mord mathit">n</span><span class="mord mathit">s</span></span></span></span></span>/边权 可以用<span class="katex math inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>d</mi><mi>o</mi><mi>u</mi><mi>b</mi><mi>l</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">double</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathit">d</span><span class="mord mathit">o</span><span class="mord mathit">u</span><span class="mord mathit">b</span><span class="mord mathit" style="margin-right: 0.01968em;">l</span><span class="mord mathit">e</span></span></span></span></span>存，<span class="katex math inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>F</mi><mo>[</mo><mi>x</mi><mo>]</mo><mo separator="true">,</mo><mi>G</mi><mo>[</mo><mi>x</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">F[x], G[x]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">F</span><span class="mopen">[</span><span class="mord mathit">x</span><span class="mclose">]</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathit">G</span><span class="mopen">[</span><span class="mord mathit">x</span><span class="mclose">]</span></span></span></span></span>要用<span class="katex math inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><mi>o</mi><mi>n</mi><mi>g</mi>&amp;ThickSpace;<mi>d</mi><mi>o</mi><mi>u</mi><mi>b</mi><mi>l</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">long \;double</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathit" style="margin-right: 0.01968em;">l</span><span class="mord mathit">o</span><span class="mord mathit">n</span><span class="mord mathit" style="margin-right: 0.03588em;">g</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathit">d</span><span class="mord mathit">o</span><span class="mord mathit">u</span><span class="mord mathit">b</span><span class="mord mathit" style="margin-right: 0.01968em;">l</span><span class="mord mathit">e</span></span></span></span></span></p><p><span class="katex math inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>D</mi><mi>i</mi><mi>j</mi><mi>k</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>a</mi></mrow><annotation encoding="application/x-tex">Dijkstra</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathit" style="margin-right: 0.02778em;">D</span><span class="mord mathit">i</span><span class="mord mathit" style="margin-right: 0.05724em;">j</span><span class="mord mathit" style="margin-right: 0.03148em;">k</span><span class="mord mathit">s</span><span class="mord mathit">t</span><span class="mord mathit" style="margin-right: 0.02778em;">r</span><span class="mord mathit">a</span></span></span></span></span>可以在做的同时处理出<span class="katex math inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">F</span></span></span></span></span>和拓扑序。 而<span class="katex math inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>F</mi><mo>[</mo><mi>x</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">F[x]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit" style="margin-right: 0.13889em;">F</span><span class="mopen">[</span><span class="mord mathit">x</span><span class="mclose">]</span></span></span></span></span>可以只开一维，因为我们枚举的<span class="katex math inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.65952em; vertical-align: 0em;"></span><span class="mord mathit">i</span></span></span></span></span></p><h3>代码 ：</h3><div class="code-toolbar"><pre class=" language-cpp"><code class="  language-cpp">#include &lt;cstdio&gt;#include &lt;cstring&gt;#include &lt;iostream&gt;#include &lt;algorithm&gt;#define mp make_pair#include &lt;queue&gt;using namespace std;#define f2 double#define f3 long double#define rev(i, p) for(Edge *i = head[p]; i; i = i-&gt;next)const int N = 1100;struct Edge { int to, len; f3 val; Edge *next;}*head[N], e[N&lt;&lt;3];inline void addEdge(int x, int y, int z, f2 w) { static int _; Edge* t; t = &amp;e[++_]; t-&gt;to = y, t-&gt;len = z, t-&gt;val = w, t-&gt;next = head[x], head[x] = t; t = &amp;e[++_]; t-&gt;to = x, t-&gt;len = z, t-&gt;val = w, t-&gt;next = head[y], head[y] = t;}int a[N], ind[N], n, m;int q[N], l, r, dis[N];f2 ans[N];f3 g[N], f[N];priority_queue&lt;pair&lt;int, int&gt; &gt; pq;bool vis[N];void getTopp(int S) { q[r = 1] = S, l = 0; f[S] = 1; for(int i = 1; i &lt;= n; i ++ ) rev(j, i) { if(dis[i]+j-&gt;len == dis[j-&gt;to]) ind[j-&gt;to] ++; } while(r &gt; l) { int u = q[++l]; rev(i, u) if(dis[u]+i-&gt;len == dis[i-&gt;to]) { if(!--ind[i-&gt;to]) q[++r] = i-&gt;to; f[i-&gt;to] += f[u]*i-&gt;val; } }}void getDis(int S) { dis[S] = 0; pq.push(mp(0, S)); while(!pq.empty()) { int u = pq.top().second; pq.pop(); if(vis[u]) continue; vis[u] = 1; rev(i, u) if(dis[i-&gt;to] &gt; dis[u]+i-&gt;len) { dis[i-&gt;to] = dis[u]+i-&gt;len; pq.push(mp(-dis[i-&gt;to], i-&gt;to)); } }}void getAns(int S) { for(int p = r; p &gt; 1; p -- ) { int u = q[p]; rev(i, u) if(dis[i-&gt;to] == dis[u]+i-&gt;len) { int v = i-&gt;to; g[u] += i-&gt;val*g[v]; } ans[u] += a[S]*f[u]*g[u]; g[u] += (f3)a[u]/f[u]; }}int main() { scanf("%d%d", &amp;n, &amp;m); for(int i = 1; i &lt;= n; i ++ ) scanf("%d", &amp;a[i]); for(int i = 1; i &lt;= m; i ++ ) { int x, y, z;double w; scanf("%d%d%d%lf", &amp;x, &amp;y, &amp;z, &amp;w); addEdge(x, y, z, w); } for(int i = 1; i &lt;= n; i ++ ) { memset(f, 0, sizeof f); memset(g, 0, sizeof g); memset(vis, 0, sizeof vis); memset(dis, 0x3f, sizeof dis); getDis(i), getTopp(i), getAns(i); } for(int i = 1; i &lt;= n; i ++ ) printf("%.8f\n", ans[i]);}</code></pre><div class="toolbar"><div class="toolbar-item"><span>C++</span></div><div class="toolbar-item"><a>Copy</a></div></div></div> </div> <div class="entry-footer clearfix"> <div class="post-like-donate text-center clearfix" id="post-like-donate"> <a href="javascript:;" data-action="love" data-id="564" class="Love "><i class="fa fa-thumbs-o-up"></i> 点赞</a> <a href="javascript:;" class="Share"><i class="fa fa-share-alt"></i> 分享</a> <div class="share-wrap" style="display: none;"> <div class="share-group"> <a href="javascript:;" class="share-plain weibo" onclick="share(&#39;weibo&#39;);" rel="nofollow"> <div class="icon-wrap"> <i class="fa fa-weibo"></i> </div> </a> <a href="javascript:;" class="share-plain twitter style-plain" onclick="share(&#39;twitter&#39;);" rel="nofollow"> <div class="icon-wrap"> <i class="fa fa-twitter"></i> </div> </a> <a href="javascript:;" class="share-plain facebook style-plain" onclick="share(&#39;facebook&#39;);" rel="nofollow"> <div class="icon-wrap"> <i class="fa fa-facebook"></i> </div> </a> <a href="javascript:;" class="share-plain googleplus style-plain" onclick="share(&#39;googleplus&#39;);" rel="nofollow"> <div class="icon-wrap"> <i class="fa fa-google-plus"></i> </div> </a> <a href="javascript:;" class="share-plain weixin pop style-plain" rel="nofollow"> <div class="icon-wrap"> <i class="fa fa-weixin"></i> </div> <div class="share-int"> <div class="qrcode" data-url="https://yirannn.com/dp/bzoj_4055/"><canvas width="150" height="150"></canvas></div> <p>打开微信“扫一扫”，打开网页后点击屏幕右上角分享按钮</p> </div> </a> </div> <script type="text/javascript"> function share(obj){ var weiboShareURL="http://service.weibo.com/share/share.php?"; var facebookShareURL="https://www.facebook.com/sharer/sharer.php?"; var twitterShareURL="https://twitter.com/intent/tweet?"; var googleplusShareURL="https://plus.google.com/share?"; var host_url="https://yirannn.com/dp/bzoj_4055/"; var title="【BZOJ 4055: [CTSC2015]misc - [最短路/DP]】题目传送门(BZOJ) >原文链接&lt; 题解 ： 这可能是网上存在的第一篇题解，反正我Baidu只百度到一个，还是404 推导： 设F[i][j]为从i到j的最短路的宽度，那么原式即求 ： R(k) = \sum\limits_{i\neq j\neq k}\frac{a_i\times a_j\times F[i][k]\times……"; var pic=""; var appkey=""; var _URL; if(obj=="weibo"){ _URL=weiboShareURL+"&appkey="+appkey+"$url="+host_url+"&title="+title+"&pic="+pic; }else if(obj=="facebook"){ _URL=facebookShareURL+"u="+host_url; }else if(obj=="twitter"){ _URL=twitterShareURL+"text="+title+"&url="+host_url; }else if(obj=="googleplus"){ _URL=googleplusShareURL+"url="+host_url; } window.open(_URL); } </script> </div> </div> <div class="footer-tag clearfix"> <div class="pull-left"> <i class="fa fa-tags"></i> <a>No Tag</a> </div> </div> </div> </div> <div class="hentry copyright text-center clearfix"> <img alt="知识共享许可协议" src="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/licenses.png"> <h5>本作品采用 <a rel="license nofollow" target="_blank" href="http://creativecommons.org/licenses/by-sa/4.0/">知识共享署名-相同方式共享 4.0 国际许可协议</a> 进行许可</h5> </div> <nav class="navigation post-navigation clearfix" role="navigation"> <div class="nav-previous clearfix"> <a title="NOIP 2017系列解题报告 - [题组/NOIP]" href="https://yirannn.com/problem_sets/noip-2017/">&lt; 上一篇</a> </div> <div class="nav-next"> <a title="BZOJ 1212: [HNOI2004]L语言 - [AC自动机/DP]" href="https://yirannn.com/dp/bzoj_1212/">下一篇 &gt;</a> </div> </nav> <div id="comments" class="comments-area"> <script type="text/javascript" language="javascript">/* <![CDATA[ */ function grin(tag) { var myField; tag = ' ' + tag + ' '; if (document.getElementById('comment') && document.getElementById('comment').type == 'textarea') { myField = document.getElementById('comment'); } else { return false; } if (document.selection) { myField.focus(); sel = document.selection.createRange(); sel.text = tag; myField.focus(); } else if (myField.selectionStart || myField.selectionStart == '0') { var startPos = myField.selectionStart; var endPos = myField.selectionEnd; var cursorPos = endPos; myField.value = myField.value.substring(0, startPos) + tag + myField.value.substring(endPos, myField.value.length); cursorPos += tag.length; myField.focus(); myField.selectionStart = cursorPos; myField.selectionEnd = cursorPos; } else { myField.value += tag; myField.focus(); } }/* ]]> */</script> <div id="respond" class="comment-respond"> <h4 id="reply-title" class="comment-reply-title">发表评论 <small><a rel="nofollow" id="cancel-comment-reply-link" href="https://yirannn.com/dp/bzoj_4055/#respond" style="display:none;">取消回复</a></small></h4> <form action="https://yirannn.com/wp-comments-post.php" method="post" id="commentform" class="comment-form"> <p class="comment-notes"><span id="email-notes">电子邮件地址不会被公开。</span> 必填项已用<span class="required">*</span>标注</p><div class="comment form-group has-feedback"><div class="input-group"><p><a href="javascript:grin(&#39;:razz:&#39;)" rel="nofollow"><img src="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/icon_razz.gif" alt="" class="size-smiley"></a><a href="javascript:grin(&#39;:sad:&#39;)" rel="nofollow"><img src="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/icon_sad.gif" alt="" class="size-smiley"></a><a href="javascript:grin(&#39;:evil:&#39;)" rel="nofollow"><img src="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/icon_evil.gif" alt="" class="size-smiley"></a><a href="javascript:grin(&#39;:exclaim:&#39;)" rel="nofollow"><img src="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/icon_exclaim.gif" alt="" class="size-smiley"></a><a href="javascript:grin(&#39;:smile:&#39;)" rel="nofollow"><img src="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/icon_smile.gif" alt="" class="size-smiley"></a><a href="javascript:grin(&#39;:redface:&#39;)" rel="nofollow"><img src="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/icon_redface.gif" alt="" class="size-smiley"></a><a href="javascript:grin(&#39;:biggrin:&#39;)" rel="nofollow"><img src="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/icon_biggrin.gif" alt="" class="size-smiley"></a><a href="javascript:grin(&#39;:surprised:&#39;)" rel="nofollow"><img src="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/icon_surprised.gif" alt="" class="size-smiley"></a><a href="javascript:grin(&#39;:eek:&#39;)" rel="nofollow"><img src="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/icon_eek.gif" alt="" class="size-smiley"></a><a href="javascript:grin(&#39;:confused:&#39;)" rel="nofollow"><img src="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/icon_confused.gif" alt="" class="size-smiley"></a><a href="javascript:grin(&#39;:idea:&#39;)" rel="nofollow"><img src="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/icon_idea.gif" alt="" class="size-smiley"></a><a href="javascript:grin(&#39;:lol:&#39;)" rel="nofollow"><img src="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/icon_lol.gif" alt="" class="size-smiley"></a><a href="javascript:grin(&#39;:mad:&#39;)" rel="nofollow"><img src="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/icon_mad.gif" alt="" class="size-smiley"></a><a href="javascript:grin(&#39;:twisted:&#39;)" rel="nofollow"><img src="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/icon_twisted.gif" alt="" class="size-smiley"></a><a href="javascript:grin(&#39;:rolleyes:&#39;)" rel="nofollow"><img src="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/icon_rolleyes.gif" alt="" class="size-smiley"></a><a href="javascript:grin(&#39;:wink:&#39;)" rel="nofollow"><img src="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/icon_wink.gif" alt="" class="size-smiley"></a><a href="javascript:grin(&#39;:cool:&#39;)" rel="nofollow"><img src="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/icon_cool.gif" alt="" class="size-smiley"></a><a href="javascript:grin(&#39;:arrow:&#39;)" rel="nofollow"><img src="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/icon_arrow.gif" alt="" class="size-smiley"></a><a href="javascript:grin(&#39;:neutral:&#39;)" rel="nofollow"><img src="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/icon_neutral.gif" alt="" class="size-smiley"></a><a href="javascript:grin(&#39;:cry:&#39;)" rel="nofollow"><img src="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/icon_cry.gif" alt="" class="size-smiley"></a><a href="javascript:grin(&#39;:mrgreen:&#39;)" rel="nofollow"><img src="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/icon_mrgreen.gif" alt="" class="size-smiley"></a></p><textarea class="form-control" id="comment" placeholder=" " name="comment" rows="5" aria-required="true" required="" onkeydown="if(event.ctrlKey){if(event.keyCode==13){document.getElementById(&#39;submit&#39;).click();return false}};"></textarea></div></div><div class="comment-form-author form-group has-feedback"><div class="input-group"><div class="input-group-addon"><i class="fa fa-user"></i></div><input class="form-control" placeholder="昵称" id="author" name="author" type="text" value="" "="" size="30"><span class="form-control-feedback required">*</span></div></div><div class="comment-form-email form-group has-feedback"><div class="input-group"><div class="input-group-addon"><i class="fa fa-envelope-o"></i></div><input class="form-control" placeholder="邮箱" id="email" name="email" type="text" value="" "="" size="30"><span class="form-control-feedback required">*</span></div></div><div class="comment-form-url form-group has-feedback"><div class="input-group"><div class="input-group-addon"><i class="fa fa-link"></i></div><input class="form-control" placeholder="网站" id="url" name="url" type="text" value="" "="" size="30"></div></div><p class="form-submit"><input name="submit" type="submit" id="submit" class="btn btn-primary" value="发表评论"> <input type="hidden" name="comment_post_ID" value="564" id="comment_post_ID"><input type="hidden" name="comment_parent" id="comment_parent" value="0"></p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="8b2f351736"></p><p style="display: none;"></p> <input type="hidden" id="ak_js" name="ak_js" value="1589721876913"></form> </div><!-- #respond --> </div> </article> </div> <div id="widget-area" class="col-md-4 hidden-xs hidden-sm"> </div> </div> </div></div><div class="clearfix"></div> <footer> <a class="cd-top visible-lg"><span class=" fa fa-chevron-up"></span></a> <div class="container"> <div class="row"> <div class="col-md-6 col-md-offset-3 text-center"> <p class="social-icons"> </p> <p>© 2016 <a href="https://yirannn.com/">Yirannn's Blog</a> All Rights Reserved.<br>Theme <a href="https://github.com/vtrois/snape" target="_blank" rel="nofollow">Snape</a> made by <a href="https://www.vtrois.com/" target="_blank" rel="nofollow">Vtrois</a><br><a href="http://www.miitbeian.gov.cn/" rel="external nofollow" target="_blank"></a></p> <p></p> </div> </div> </div> </footer> <div id="landlord"> <div class="message" style="opacity:0"></div> <canvas id="live2d" width="280" height="250" class="live2d" style="opacity:0;"></canvas> <div class="hide-button">隐藏</div> <div class="switch-button">变装</div> </div> <script type="text/javascript" src="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/jquery.min.js"></script><script type="text/javascript" src="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/katex.min.js"></script><script type="text/javascript" src="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/clipboard.min.js"></script><script type="text/javascript" src="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/prism-core.min.js"></script><script type="text/javascript" src="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/prism-autoloader.min.js"></script><script type="text/javascript" src="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/prism-toolbar.min.js"></script><script type="text/javascript" src="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/prism-line-numbers.min.js"></script><script type="text/javascript" src="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/prism-show-language.min.js"></script><script type="text/javascript" src="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/prism-copy-to-clipboard.min.js"></script><script type="text/javascript" src="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/jquery.min(1).js"></script><script type="text/javascript" src="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/bootstrap.min.js"></script><script type="text/javascript" src="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/bootsnav.js"></script><script type="text/javascript" src="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/jquery.qrcode.min.js"></script><script type="text/javascript" src="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/snape.js"></script><script type="text/javascript" src="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/wp-embed.min.js"></script><script async="async" type="text/javascript" src="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/form.js"></script> <script type="text/javascript"> (function ($) { $(document).ready(function () { $(".katex.math.inline").each(function () { var parent = $(this).parent()[0]; if (parent.localName !== "code") { var texTxt = $(this).text(); var el = $(this).get(0); try { katex.render(texTxt, el); } catch (err) { $(this).html("<span class=\'err\'>" + err); } } else { $(this).parent().text($(this).parent().text()); } }); $(".katex.math.multi-line").each(function () { var texTxt = $(this).text(); var el = $(this).get(0); try { katex.render(texTxt, el, {displayMode: true}) } catch (err) { $(this).html("<span class=\'err\'>" + err) } }); }) })(jQuery); </script> <script type="text/javascript"> Prism.plugins.autoloader.languages_path = "https://cdn.jsdelivr.net/wp/wp-editormd/tags/10.0.3/assets/Prism.js/components/"; </script> 
<!-- Dynamic page generated in 0.504 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2020-05-17 21:23:44 -->

<!-- super cache --><script src="./BZOJ 4055_ [CTSC2015]misc - [最短路_DP] - Yirannn&#39;s Blog_files/prism-clike.min.js" async=""></script></div></body></html>